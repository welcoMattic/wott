<?php

namespace wott\CoreBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * FilmRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class FilmRepository extends EntityRepository
{

    public function getFilmsByPopularity($limit, $genre = null, $offset = null)
    {
        $qb = $this->createQueryBuilder('f');

        if ($genre) {
          $query = $qb->where(':genre MEMBER OF f.genres')
                      ->setParameter('genre', $genre)
                      ->orderBy('f.popularity', 'DESC')
                      ->setMaxResults($limit)
                      ->setFirstResult($offset)
                      ->getQuery();
        } else {
          $query = $qb->orderBy('f.popularity', 'DESC')
                      ->setMaxResults($limit)
                      ->setFirstResult($offset)
                      ->getQuery();
        }

        return $query->getResult();
    }

}
